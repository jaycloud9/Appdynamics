{
  "variables": {
    "type": "",
    "os": "",
    "build": ""
  },
  "builders": [{
    "type": "azure-arm",
      "client_id": "585b08ee-20fd-4824-97aa-16a65f631916",
      "client_secret": "Blue1Sky$",
      "subscription_id": "51df121a-2371-45a4-8387-d72ef028239f",
      "tenant_id": "d5d2540f-f60a-45ad-86a9-e2e792ee6669",
      "resource_group_name": "mpdevtestrg",
      "storage_account": "mpdevtestsa",
      "capture_container_name": "{{user `os`}}",
      "capture_name_prefix": "{{user `type`}}_{{user `build`}}",
      "ssh_username": "mpadmin",
      "ssh_password": "mARKETpLACE99",
      "image_publisher": "redhat",
      "image_offer": "RHEL",
      "image_sku": "7.2",
      "ssh_pty": "true",
      "location": "UK West",
      "vm_size": "Standard_A2",
      "os_type": "Linux",
      "ssh_username": "{{user `ssh_user`}}",
      "ssh_password": "{{user `ssh_pass`}}"
  }],

  "provisioners": [
    {
      "type": "shell",
      "scripts": "Scripts/ansible.sh",
      "execute_command": "echo '{{user `ssh_pass`}}' | {{ .Vars }} sudo -S -E sh '{{ .Path }}'"
    },
    {
      "type": "shell",
      "inline": [
        "echo '**** Configuring application'",
      "sudo yum update -y"
      ]
    },
    {
      "type": "ansible-local",
      "playbook_file": "../paas-config/h2image.yml",
      "inventory_file": "../paas-config/hosts",
      "extra_arguments": [ "--extra-vars \"h2_directory='/opt/temenos' yum_server='51.141.31.84'\"" ],
      "role_paths": [
        "../paas-config/roles/java",
        "../paas-config/roles/h2"
        ]
    },
    {
      "type": "shell",
      "inline": [
        "sudo subscription-manager remove --all",
      "sudo subscription-manager unregister"
      ]
    },

    {
      "type": "shell",
      "inline": "sudo waagent -deprovision+user -force && export HISTSIZE=0 && sync",
      "skip_clean": "true"
    }

  ]

}
