---
  - hosts: all
    vars:
      - dataloop_api_key: d2fc7190-7176-4415-b498-814e52423823
    roles:
      - dataloop-ansible
      - base

  - hosts: Type_formation
    roles:
      - dns_server

  - hosts: Type_node_worker:Type_master:Type_node_infra
    roles:
      - oscp_prereq

  - hosts: Type_gitlab
    vars:
      gitlab_external_url: "http://gitlab.temenos.cloud/"
      gitlab_redirect_http_to_https: 'false'
      gitlab_nginx_listen_https: 'false'
      gitlab_root_password: 'mARKETpLACE99'
      gitlab_nginx_listen_port: 8081
      gitlab_nginx_listen_addresses:
        - "0.0.0.0"
    roles:
      - gitlab
    tasks:
      - name: Restart Gitlab
        shell: "gitlab-ctl restart"

  - hosts: Type_formation
    roles:
      - oscp_install

  - hosts: Type_storage
    vars:
      oscp_storage_nfs_directory: "/exports"
    roles:
      - oscp_storage
    tasks:
      - name: "Stopping firewall"
        shell: "systemctl stop firewalld.service"

  - hosts: Type_master
    vars:
      oscp_storage_nfs_directory: "/exports"
    roles:
      - oscp_setup

  - hosts: Docker_true
    roles:
      - docker
      - dataloop-docker

  - hosts: Type_node_worker:Type_master:Type_node_infra
    tasks:
      - name: "Stopping firewall"
        shell: "systemctl stop firewalld.service"
      - name: "Restart Openshift Nodes"
        shell: "systemctl restart atomic-openshift-node.service"
  - hosts: Type_master
    tasks:
      - name: "Restart Openshift Masters"
        shell: "systemctl restart atomic-openshift-master.service"
