---
- name: "Set up Storage disks"
  filesystem: fstype=xfs dev=/dev/xvdh

- name: "Mount volume"
  mount: name={{ose_storage_nfs_directory}} src=/dev/xvdh fstype=xfs opts=noatime state=mounted

- name: "Push NFS exports file"
  template: src=nfs_exports.j2 dest=/etc/exports

- name: "Ensure NFS configures"
  service: name=nfs-config state=started enabled=yes

- name: "Ensure NFS started"
  service: name=nfs-server state=started enabled=yes

- name: "Create PV Directories"
  shell: "mkdir -p {{ose_storage_nfs_directory}}/pv/pv{1..20}; chown nfsnobody:nfsnobody -R {{ose_storage_nfs_directory}}"

- name: "Push PV template file"
  template: src=persisted_storage.yaml.j2 dest=/tmp/pv-template.yaml

- name: "Copy create pv script"
  copy: src=create_pvs.sh dest=/tmp/create_pvs.sh

- name: "create pvs"
  shell: "cd /tmp; bash create_pvs.sh"
